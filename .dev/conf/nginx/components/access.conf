# Forbidden execude files
location ~* ^/(attachments|upload|assets|uploads|storage)/.*.(php|php5|php4)$ {
    # deny all;
    return 404;
}

# Forbidden files or directories
location ~ ^/(node_modules|LICENSE|package.json|README.md|vendor|console|htpasswd|composer\.lock|composer\.json|yii|init|artisan|webman|think|ftpquota|environments|tests|requirements\.php){
    return 404;
}

# this prevents file leftovers to be seen, such as vim temp files.
location ~ ~$ {
    access_log off;
    log_not_found off;
    deny all;
}

# Forbidden Access sensitive files
location ~* \.(env|ini|user.ini|htaccess|sql|db|mdb|log|txt|jar|war|sh|py|tar|zip|zstd|gz|tar\.gz|rar|bak|lua|7z|config|swp|dist|inc|tgz|git|svn|hg|bzr|project|fla|psd|orig|save|swo|asdf|old|tmp|temp|cache|backup|backups|copy|dump)$ {
    access_log off;
    log_not_found off;
    return 404;
}

#Prohibit putting sensitive files in certificate verification directory
location ~ "^/\.well-known/.*\.(php|jsp|py|js|css|lua|ts|go|sql|log|txt|jar|war|sh|py|tar|zip|zstd|gz|rar|bak|lua|7z)$" {
    access_log off;
    log_not_found off;
    return 404;
}

# Directory verification related settings for one-click application for SSL certificate
location ~ \.well-known {
    allow all;
}

# Block common attack patterns in URI
location ~* (eval\(|base64_decode|gzinflate|__construct|__destruct|__wakeup|preg_replace|create_function|file_get_contents|phpinfo|system|exec|shell_exec|passthru|show_source) {
    deny all;
    access_log off;
    log_not_found off;
}

# Block URL parameters containing dangerous PHP functions
if ($query_string ~* "(shell_exec|exec|system|passthru|eval|base64_decode|gzinflate|preg_replace|create_function|file_get_contents|phpinfo|assert|proc_open|popen|curl_exec|curl_multi_exec|parse_ini_file|show_source|__construct|__destruct|__wakeup)") {
    return 403;
}

# Block SQL injection attempts in URL parameters
if ($query_string ~* "(union.*select|select.*from|insert.*into|delete.*from|drop.*table|update.*set|where.*=|script.*>|javascript:|onerror=|onload=|<script|</script)") {
    return 403;
}

# Block common file inclusion patterns
if ($query_string ~* "(../|..%2f|..%5c|etc%2fpasswd|win.ini|system32|/etc/passwd|windows/system32)") {
    return 403;
}

# Block XSS attempts in URL parameters
if ($query_string ~* "(<script|javascript:|data:text/html|vbscript:|onload=|onerror=|onclick=|<iframe|<object|<embed|<svg|alert\()") {
    return 403;
}

# Prevent access to hidden files
location ~ /\. {
    access_log off;
    log_not_found off;
    return 404;
}
